<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#f57c00">

  <title>川口地区社会体育館 日程表</title>

  <style>
    /* =========================================================
       基本変数（テーマ全体）
       ========================================================= */
    :root {
      /* 色 */
      --color-primary: #4a6fa5;
      --color-bg: #f3f4f6;
      --color-white: #ffffff;
      --color-border: #999;

      /* 曜日背景 */
      --color-sat: #f7fbff;
      --color-sun: #fff7f7;
      --color-holiday: #fffdf5;

      /* イベント色 */
      --color-badminton: #4caf50;
      --color-tabletennis: #2196f3;
      --color-volleyball: #cca152;
      --color-kids: #9c27b0;
      --color-default: #607d8b;

      /* 曜日バッジ */
      --badge-sun: #e57373;
      --badge-sat: #339FF6;
      --badge-weekday: #d1b3ff;
      --badge-holiday: var(--badge-sun);

      /* UI */
      --radius: 6px;
      --radius-pill: 20px;
      --shadow: 0 1px 2px rgba(0,0,0,0.15);

      /* フォント */
      --font-base: 12px;
      --font-small: 11px;
      --font-xs: 8px;
      --font-title: 20px;

      /* 余白 */
      --space-xs: 4px;
      --space-s: 6px;
      --space-m: 12px;
      --space-l: 18px;

      /* 印刷用 */
      --print-row-height: 31px;
    }

    /* =========================================================
       全体
       ========================================================= */
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--color-bg);
    }

    h1 {
      text-align: center;
      padding: var(--space-l);
      margin: 0;
      background: var(--color-primary);
      color: var(--color-white);
      font-size: var(--font-title);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* =========================================================
       タブ
       ========================================================= */
    .tabs {
      display: flex;
      gap: var(--space-s);
      padding: var(--space-m);
      overflow-x: auto;
      background: var(--color-white);
      border-bottom: 1px solid var(--color-border);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .tab {
      padding: 8px 18px;
      border-radius: var(--radius-pill);
      background: #e6e6e6;
      cursor: pointer;
      white-space: nowrap;
      font-size: 14px;
      transition: 0.2s;
    }

    .tab:hover {
      background: #d5d5d5;
    }

    .tab.active {
      background: var(--color-primary);
      color: var(--color-white);
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }

    /* =========================================================
       テーブル
       ========================================================= */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--space-s);
      background: var(--color-white);
      table-layout: fixed;
      border-radius: var(--radius);
      overflow: hidden;
    }

    th {
      background: #f5f5f5;
      font-weight: 600;
      padding: var(--space-s);
    }

    th, td {
      border: 1px solid var(--color-border);
      padding: var(--space-xs) var(--space-s);
      font-size: var(--font-base);
      line-height: 1.2;
      white-space: normal;
      height: auto;
      min-height: 48px;
    }

    /* PC 列幅 */
    th:nth-child(1), td:nth-child(1) { width: 10%; }
    th:nth-child(2), td:nth-child(2) { width: 40%; }
    th:nth-child(3), td:nth-child(3) { width: 50%; }

    /* =========================================================
       行背景（曜日・祝日）
       ========================================================= */
    .saturday { background: var(--color-sat); }
    .sunday   { background: var(--color-sun); }
    .holiday  { background: var(--color-holiday); }

    tr.today-row {
      outline: none !important;
      background: none !important;
    }

    /* =========================================================
       日付セル
       ========================================================= */
    .date-cell {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-end;
      text-align: right;
    }

    .date-top,
    .date-number {
      font-family: "Nunito", "Hiragino Sans", sans-serif;
      font-size: 20px;
      font-weight: 600;
    }

    .date-bottom {
      font-size: var(--font-xs);
      color: #d32f2f;
      margin-top: 2px;
    }

    .holiday .date-bottom {
       display: none;
    }

    /* 曜日バッジ */
    .weekday-badge {
      padding: 1px 4px;
      margin-left: 3px;
      border-radius: 8px;
      font-size: 9px;
      color: #fff;
    }

    .w-sun { background: var(--badge-sun); }
    .w-sat { background: var(--badge-sat); }
    .w-mon,
    .w-tue,
    .w-wed,
    .w-thu,
    .w-fri { background: var(--badge-weekday); }

    .holiday .weekday-badge {
      background: var(--badge-holiday) !important;
    }

    /* =========================================================
       イベント
       ========================================================= */
    .event-box {
      display: flex;
      flex-wrap: wrap;
      gap: 2px 4px;
    }

    .event {
      padding: 2px 6px;
      border-radius: var(--radius);
      color: var(--color-white);
      font-size: var(--font-small);
      line-height: 1.2;
      white-space: normal;
      box-shadow: var(--shadow);
    }

    .event time {
      color: #ffff22;
      font-weight: 700;
    }

    /* 色分け */
    .color-badminton { background: var(--color-badminton); }
    .color-tabletennis { background: var(--color-tabletennis); }
    .color-volleyball { background: var(--color-volleyball); }
    .color-kids { background: var(--color-kids); }
    .color-default { background: var(--color-default); }

    /* =========================================================
       スマホ最適化
       ========================================================= */
    @media (max-width: 600px) {

      h1 {
        font-size: 17px;
        padding: 10px;
      }

      .tab {
        font-size: 13px;
        padding: 6px 10px;
      }

      th, td {
        font-size: 20px;
        padding: 2px 3px;
        height: 34px;
      }

      table, th, td {
        border: 1.5px solid #ccc;
      } 

      th:nth-child(1), td:nth-child(1) { width: 20%; }
      th:nth-child(2), td:nth-child(2) { width: 35%; }
      th:nth-child(3), td:nth-child(3) { width: 45%; }

      .event {
        font-weight: 400; /*← スマホだけ太文字は700に */
        font-size: 13px;
        max-width: 100%;
        border-radius: 10px;
        opacity: 1;
        display: block;
        line-height: 1.3;
      }
      .event time {
        display: block; /* ← これで時間が1行目に固定される */
        font-weight: 600;
        margin-bottom: 2px;
      }
      .event-box {
        gap: 1px 3px;
      }

     /* 日付の数字を大きく */
     .date-top {
       font-size: 22px;
     }

     /* 曜日バッジを大きく */
     .weekday-badge {
       font-size: 20px;
       padding: 2px 6px;
     }
   }

    /* =========================================================
       印刷用
       ========================================================= */
    @media print {

      @page {
        size: A3 portrait;
        margin: 10mm;
      }

      .tabs { display: none !important; }

      h1 {
        display: block !important;
        margin-bottom: 6px;
      }

      th:nth-child(1), td:nth-child(1) { width: 10% !important; }
      th:nth-child(2), td:nth-child(2) { width: 40% !important; }
      th:nth-child(3), td:nth-child(3) { width: 50% !important; }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }

      th, td {
        border: 1px solid #000;
        padding: 3px 4px;
        height: var(--print-row-height);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .event {
        background: #fff !important;
        color: #000 !important;
        border-radius: 0;
        padding: 2px 4px;
      }

      .event time {
        color: #000 !important;
      }

      .saturday,
      .sunday,
      .holiday,
      tr.today-row {
        background: #fff !important;
      }

      .weekday-badge {
        background: none !important;
        color: none !important;
        color: #000 !important;
        border: 1px solid #000;
      }

      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      td .event {
        white-space: normal !important;
        display: block;
      }

      td {
        height: auto !important;
      }

      .holiday .weekday-badge {
        background: none !important;
        color: #000 !important;
        border: 1px solid #000 !important;
      } 
    }
  </style>
</head>
<body>

  <h1>川口地区社会体育館 日程表</h1>

  <div class="tabs" id="monthTabs"></div>

  <div id="calendarContainer">
    <div class="loading">読み込み中...</div>
  </div>

  <script>
    const CALENDAR_ID =
      "c15c3451e52f787202dca97fbd0e35c908d5972611deb534d78c8f6b46262895@group.calendar.google.com";

    const HOLIDAY_CALENDAR_ID =
      "japanese__ja@holiday.calendar.google.com";

    const API_KEY = "AIzaSyA5YSgL1PG9e61Nk7b-SbPV99XMvHeGGtI";

    const WEEKDAYS = ["日", "月", "火", "水", "木", "金", "土"];

    const today = new Date();
    const todayStr = today.toISOString().split("T")[0];

    // 月タブの設定（前月〜3か月後）
    const months = [];
    for (let i = -1; i <= 3; i++) {
      const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
      months.push({
        label: `${d.getFullYear()}年${d.getMonth() + 1}月`,
        year: d.getFullYear(),
        month: d.getMonth()
      });
    }

    const tabArea = document.getElementById("monthTabs");
    months.forEach((m, idx) => {
      const tab = document.createElement("div");
      tab.className = "tab" + (idx === 1 ? " active" : "");
      tab.textContent = m.label;
      tab.onclick = () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        loadMonth(m.year, m.month);
      };
      tabArea.appendChild(tab);
    });

    // イベント取得
    async function fetchEvents(calendarId, year, month) {
      const start = new Date(year, month, 1).toISOString();
      const end = new Date(year, month + 1, 1).toISOString();

      const url =
        `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events` +
        `?key=${API_KEY}&timeMin=${start}&timeMax=${end}` +
        `&singleEvents=true&orderBy=startTime`;

      const res = await fetch(url);
      const data = await res.json();
      return data.items || [];
    }

    // 時間帯分類（終日イベントは午前扱い）
    function classifyTime(ev) {
      if (!ev.start.dateTime) return "午前";
      const hour = new Date(ev.start.dateTime).getHours();
      if (hour < 12) return "午前";
      return "午後";  /* 夜間も午後に統合 */
    }

    // 種目ごとの色分け
    function detectColor(title) {
      if (title.includes("バド")) return "color-badminton";
      if (title.includes("卓球")) return "color-tabletennis";
      if (title.includes("バレー")) return "color-volleyball";
      if (title.includes("キッズ")) return "color-kids";
      return "color-default";
    }

    // テーブル描画
    function renderTable(events, holidayMap, year, month) {
      const container = document.getElementById("calendarContainer");
      container.innerHTML = "";

      const table = document.createElement("table");
      table.innerHTML = `
        <tr>
          <th>日付</th>
          <th>午前</th>
          <th>午後</th>
        </tr>
      `;

      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let day = 1; day <= daysInMonth; day++) {
        const dateObj = new Date(year, month, day);
        const weekday = WEEKDAYS[dateObj.getDay()];
        const dateStr =
          `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;

        const dayEvents = events.filter(ev => {
          const d = ev.start.date || ev.start.dateTime.split("T")[0];
          return d === dateStr;
        });

        const slots = { "午前": [], "午後": [] };

        dayEvents.forEach(ev => {
          const time = classifyTime(ev);
          const color = detectColor(ev.summary || "");
          const title = ev.summary || "";

          const start = ev.start.dateTime ? new Date(ev.start.dateTime) : null;
          const end   = ev.end.dateTime   ? new Date(ev.end.dateTime)   : null;

          const format = d =>
            String(d.getHours()).padStart(2, "0") + ":" +
            String(d.getMinutes()).padStart(2, "0");

          let timeLabel = "";
          if (start && end) {
            timeLabel = `${format(start)}–${format(end)}`;
          }

          const displayText = timeLabel
            ? `<time>${timeLabel}</time> ${title}`
            : title;

          // ホバー・ポップアップ用（time部分は文字として）
          const hoverText = timeLabel
            ? `${timeLabel} ${title}`
            : title;

          slots[time].push({
            start: start,
            html: `<div class="event ${color}" data-fulltext="${hoverText}">${displayText}</div>`
          });
        });

        // 時間順にソート
        slots["午前"].sort((a, b) => a.start - b.start);
        slots["午後"].sort((a, b) => a.start - b.start);

        const weekdayClass = {
          "日": "w-sun",
          "月": "w-mon",
          "火": "w-tue",
          "水": "w-wed",
          "木": "w-thu",
          "金": "w-fri",
          "土": "w-sat"
        }[weekday];

        const dateCell = `
          <div class="date-cell">
            <div class="date-top">
              ${day}
              <span class="weekday-badge ${weekdayClass}">${weekday}</span>
            </div>
            <div class="date-bottom">${holidayMap[dateStr] || ""}</div>
          </div>
        `;
        let rowClass = "";
        if (holidayMap[dateStr]) rowClass = "holiday";
        else if (weekday === "日") rowClass = "sunday";
        else if (weekday === "土") rowClass = "saturday";

        const isToday = (dateStr === todayStr);

        const tr = document.createElement("tr");
        tr.className = rowClass + (isToday ? " today-row" : "");
        tr.innerHTML = `
          <td>${dateCell}</td>
          <td><div class="event-box">${slots["午前"].map(e => e.html).join("")}</div></td>
          <td><div class="event-box">${slots["午後"].map(e => e.html).join("")}</div></td>
        `;
        table.appendChild(tr);
      }

      // クリックで詳細ポップアップ
      table.addEventListener("click", function(e) {
        const eventDiv = e.target.closest(".event");
        if (!eventDiv) return;

        const text = eventDiv.getAttribute("data-fulltext") || eventDiv.textContent;

        const modal = document.getElementById("eventModal");
        modal.textContent = text;
        modal.style.display = "block";

        // 3秒後に自動で閉じる
        setTimeout(() => {
          modal.style.display = "none";
        }, 3000);
      });

      container.appendChild(table);
    }

    // 月読み込み
    async function loadMonth(year, month) {
      const container = document.getElementById("calendarContainer");
      container.innerHTML = `<div class="loading">読み込み中...</div>`;

      const events = await fetchEvents(CALENDAR_ID, year, month);
      const holidayEvents = await fetchEvents(HOLIDAY_CALENDAR_ID, year, month);

      const holidayMap = {};
      holidayEvents.forEach(ev => {
        const date = ev.start.date || ev.start.dateTime.split("T")[0];
        holidayMap[date] = ev.summary;
      });

      renderTable(events, holidayMap, year, month);
    }

    // 初期表示は「今月」
    loadMonth(today.getFullYear(), today.getMonth());
  </script>

  <!-- クリックで開く詳細ポップアップ -->
  <div id="eventModal" style="
    display:none;
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%, -50%);
    background:#333;
    color:#fff;
    padding:12px 16px;
    border-radius:8px;
    font-size:14px;
    z-index:9999;
    max-width:80%;
    white-space:pre-wrap;
  "></div>
  
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js");
    });
  }
</script>
</body>
</html>








