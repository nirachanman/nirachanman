<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#f57c00">

  <title>川口地区社会体育館 日程表</title>

  <style>
    /* =========================================================
       基本変数（テーマ全体）
       ========================================================= */
    :root {
      --color-primary: #4a6fa5;
      --color-bg: #f3f4f6;
      --color-white: #ffffff;
      --color-border: #999;

      --color-sat: #f7fbff;
      --color-sun: #fff7f7;
      --color-holiday: #fffdf5;

      --color-badminton: #4caf50;
      --color-tabletennis: #2196f3;
      --color-volleyball: #cca152;
      --color-kids: #9c27b0;
      --color-iwate: #ff69b4;
      --color-default: #607d8b;

      --badge-sun: #e57373;
      --badge-sat: #339FF6;
      --badge-weekday: #d1b3ff;
      --badge-holiday: var(--badge-sun);

      --radius: 6px;
      --radius-pill: 20px;
      --shadow: 0 1px 2px rgba(0,0,0,0.15);

      --font-base: 12px;
      --font-small: 11px;
      --font-xs: 8px;
      --font-title: 20px;

      --space-xs: 4px;
      --space-s: 6px;
      --space-m: 12px;
      --space-l: 18px;

      --print-row-height: 35px;
    }

    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--color-bg);
    }

    h1 {
      text-align: center;
      padding: var(--space-l);
      margin: 0;
      background: var(--color-primary);
      color: var(--color-white);
      font-size: var(--font-title);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .tabs {
      display: flex;
      gap: var(--space-s);
      padding: var(--space-m);
      overflow-x: auto;
      background: var(--color-white);
      border-bottom: 1px solid var(--color-border);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .tab {
      padding: 8px 18px;
      border-radius: var(--radius-pill);
      background: #e6e6e6;
      cursor: pointer;
      white-space: nowrap;
      font-size: 14px;
      transition: 0.2s;
    }

    .tab:hover {
      background: #d5d5d5;
    }

    .tab.active {
      background: var(--color-primary);
      color: var(--color-white);
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      background: var(--color-white);
      table-layout: fixed;
      border-radius: var(--radius);
      overflow: hidden;
    }

    th {
      background: #f5f5f5;
      font-weight: 600;
      padding: var(--space-s);
    }

    th, td {
      border: 1px solid var(--color-border);
      padding: var(--space-xs) var(--space-s);
      font-size: var(--font-base);
      line-height: 1.2;
      white-space: normal;
      height: auto;
      min-height: 48px;
    }

    th:nth-child(1), td:nth-child(1) { width: 10%; }
    th:nth-child(2), td:nth-child(2) { width: 35%; }
    th:nth-child(3), td:nth-child(3) { width: 55%; }

    .saturday { background: var(--color-sat); }
    .sunday   { background: var(--color-sun); }
    .holiday  { background: var(--color-holiday); }

    tr.today-row {
      outline: none !important;
      background: none !important;
    }

    .date-cell {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-end;
      text-align: right;
    }

    .date-top {
      font-size: 20px;
      font-weight: 600;
    }

    .date-bottom {
      font-size: var(--font-xs);
      color: #d32f2f;
      margin-top: 2px;
    }

    .weekday-badge {
      padding: 1px 4px;
      margin-left: 3px;
      border-radius: 8px;
      font-size: 9px;
      color: #fff;
    }

    .w-sun { background: var(--badge-sun); }
    .w-sat { background: var(--badge-sat); }
    .w-mon,
    .w-tue,
    .w-wed,
    .w-thu,
    .w-fri { background: var(--badge-weekday); }

    .holiday .weekday-badge {
      background: var(--badge-holiday) !important;
    }

    .event-box {
      display: flex;
      flex-wrap: wrap;
      gap: 2px 4px;
    }

    .event {
      padding: 2px 6px;
      border-radius: var(--radius);
      color: var(--color-white);
      font-size: var(--font-small);
      line-height: 1.2;
      white-space: normal;
      box-shadow: var(--shadow);
    }

    .event time {
      color: #ffff22;
      font-weight: 700;
    }

    .color-badminton   { background: var(--color-badminton); }
    .color-tabletennis { background: var(--color-tabletennis); }
    .color-volleyball  { background: var(--color-volleyball); }
    .color-kids        { background: var(--color-kids); }
    .color-iwate       { background: var(--color-iwate); }
    .color-default     { background: var(--color-default); }

    /* =========================================================
       ▼ スマホ縦向き（午前・午後 → 1列に統合）
       ========================================================= */
    @media (max-width: 600px) {

      th:nth-child(2),
      td:nth-child(2),
      th:nth-child(3),
      td:nth-child(3) {
        display: none !important;
      }

      th:nth-child(1),
      td:nth-child(1) {
        width: 20% !important;
        display: table-cell !important;
      }

      td.merged-events {
        width: 80% !important;
        display: table-cell !important;
        vertical-align: top;
      }
    }

    /* =========================================================
       ▼ スマホ横向き（ランドスケープ）行間調整
       ========================================================= */
    @media screen and (max-height: 600px) {

      th, td {
        font-size: 14px !important;
        padding: 2px 4px !important;
        min-height: 48px !important;
        height: auto !important;
        line-height: 1.1 !important;
      }

      .event {
        font-size: 11px !important;
        padding: 1px 4px !important;
        line-height: 1.1 !important;
      }

      .date-top {
        font-size: 16px !important;
      }

      .weekday-badge {
        font-size: 10px !important;
        padding: 1px 4px !important;
      }

      td.merged-events {
        width: 80% !important;
      }
        /* スマホ表示：イベントを2段にする */
        /* スマホ縦向き：イベントを2段にする（merged-events にも適用） */
     .merged-events .event,
     .event {
       display: flex;
       flex-direction: column;
       align-items: flex-start;
       line-height: 1.2;
     }

     .merged-events .event time,
     .event time {
       display: block;
       font-weight: 700;
       margin-bottom: 2px;
     }

     .merged-events .event-box,
     .event-box {
       display: flex;
       flex-wrap: wrap;
       gap: 4px;
     }

       /* スマホ表示：フォントを少し大きくする */
  th, td {
    font-size: 16px !important;   /* ← 全体の文字を少し大きく */
  }

  .event {
    font-size: 16px !important;   /* ← イベント名を少し大きく */
  }

  .event-time {
    font-size: 15px !important;   /* ← 時間も少し大きく */
  }

  .event-title {
    font-size: 14px !important;   /* ← タイトルは控えめに */
  }

  .weekday-badge {
    font-size: 12px !important;   /* ← 曜日バッジも少し大きく */
  }
      
       /* スマホ縦向き：merged-events にもフォントを適用 */
.merged-events .event {
  font-size: 15px !important;
}

.merged-events .event-time {
  font-size: 15px !important;
}

.merged-events .event-title {
  font-size: 14px !important;
}    
    }

    /* 印刷用（あなたのコードそのまま） */
        /* 印刷用（あなたのコードそのまま） */
    @media print {

      @page {
        size: A3 portrait;
        margin: 10mm;
      }

      .tabs {
        display: none !important;
      }

      h1 {
        display: block !important;
        margin-bottom: 6px;
      }

      th:nth-child(1), td:nth-child(1) { width: 10% !important; }
      th:nth-child(2), td:nth-child(2) { width: 40% !important; }
      th:nth-child(3), td:nth-child(3) { width: 50% !important; }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }

      th, td {
        border: 1px solid #000;
        padding: 3px 4px;
        height: var(--print-row-height);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .event {
        background: #fff !important;
        color: #000 !important;
        border-radius: 0;
        padding: 2px 4px;
      }

      .event time {
        color: #000 !important;
      }

      .saturday,
      .sunday,
      .holiday,
      tr.today-row {
        background: #fff !important;
      }

      .weekday-badge {
        background: none !important;
        color: #000 !important;
        border: 1px solid #000;
      }

      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      td .event {
        white-space: normal !important;
        display: block;
      }

      td {
        height: auto !important;
      }

      .holiday .weekday-badge {
        background: none !important;
        color: #000 !important;
        border: 1px solid #000 !important;
      }

      /* 省略：あなたのコードをそのまま保持 */
    }
  </style>
</head>

<body>

  <h1>川口地区社会体育館 日程表</h1>

  <div class="tabs" id="monthTabs"></div>

  <div id="calendarContainer">
    <div class="loading">読み込み中...</div>
  </div>

  <script>
    const CALENDAR_ID =
      "c15c3451e52f787202dca97fbd0e35c908d5972611deb534d78c8f6b46262895@group.calendar.google.com";

    const HOLIDAY_CALENDAR_ID =
      "japanese__ja@holiday.calendar.google.com";

    const API_KEY = "AIzaSyA5YSgL1PG9e61Nk7b-SbPV99XMvHeGGtI";

    const WEEKDAYS = ["日", "月", "火", "水", "木", "金", "土"];

    const today = new Date();
    const todayStr = today.toISOString().split("T")[0];

    /* =========================================================
       ▼ 新しい mergeEventsForMobile（完全版）
       ========================================================= */
function mergeEventsForMobile() {
  if (window.innerWidth > 600) return;

  document.querySelectorAll("#calendarContainer table tr").forEach(row => {
    const amCell = row.querySelector("td:nth-child(2)");
    const pmCell = row.querySelector("td:nth-child(3)");

    if (!amCell || !pmCell) return;

    const merged = document.createElement("td");
    merged.className = "merged-events";

    // ▼ 午前・午後のイベントを2段構造に変換
    const convert = html => {
      const div = document.createElement("div");
      div.innerHTML = html;
      div.querySelectorAll(".event").forEach(ev => {
        const html = ev.innerHTML.trim();
        const timeMatch = html.match(/<time>(.*?)<\/time>/);
        const title = html.replace(/<time>.*?<\/time>/, "").trim();
        const time = timeMatch ? timeMatch[1] : "";

        ev.innerHTML = `
          <div class="event-time">${time}</div>
          <div class="event-title">${title}</div>
        `;
      });
      return div.innerHTML;
    };

    merged.innerHTML = `
      <div class="event-box">
        ${convert(amCell.innerHTML)}
        ${convert(pmCell.innerHTML)}
      </div>
    `;

    row.appendChild(merged);
  });
}


    /* =========================================================
       ▼ 以下、あなたの既存コード（変更なし）
       ========================================================= */

    const months = [];
    for (let i = -1; i <= 12; i++) {
      const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
      months.push({
        label: `${d.getFullYear()}年${d.getMonth() + 1}月`,
        year: d.getFullYear(),
        month: d.getMonth()
      });
    }

    const tabArea = document.getElementById("monthTabs");
    months.forEach((m, idx) => {
      const tab = document.createElement("div");
      tab.className = "tab" + (idx === 1 ? " active" : "");
      tab.textContent = m.label;
      tab.onclick = () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        loadMonth(m.year, m.month);
      };
      tabArea.appendChild(tab);
    });

    async function fetchEvents(calendarId, year, month) {
      const start = new Date(year, month, 1).toISOString();
      const end = new Date(year, month + 1, 1).toISOString();

      const url =
        `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events` +
        `?key=${API_KEY}&timeMin=${start}&timeMax=${end}` +
        `&singleEvents=true&orderBy=startTime`;

      const res = await fetch(url);
      const data = await res.json();
      return data.items || [];
    }

    function classifyTime(ev) {
      if (!ev.start.dateTime) return "午前";
      const hour = new Date(ev.start.dateTime).getHours();
      return hour < 12 ? "午前" : "午後";
    }

    function detectColor(title) {
      if (title.includes("バド")) return "color-badminton";
      if (title.includes("卓球")) return "color-tabletennis";
      if (title.includes("バレー")) return "color-volleyball";
      if (title.includes("スマイル")) return "color-kids";
      if (title.includes("いわて")) return "color-iwate";
      return "color-default";
    }

    function renderTable(events, holidayMap, year, month) {
      const container = document.getElementById("calendarContainer");
      container.innerHTML = "";

      const table = document.createElement("table");
      table.innerHTML = `
        <tr>
          <th>日</th>
          <th>午前</th>
          <th>午後</th>
        </tr>
      `;

      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let day = 1; day <= daysInMonth; day++) {
        const dateObj = new Date(year, month, day);
        const weekday = WEEKDAYS[dateObj.getDay()];
        const dateStr =
          `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;

        const dayEvents = events.filter(ev => {
          const d = ev.start.date || ev.start.dateTime.split("T")[0];
          return d === dateStr;
        });

        const slots = { "午前": [], "午後": [] };

        dayEvents.forEach(ev => {
          const time = classifyTime(ev);
          const color = detectColor(ev.summary || "");
          const title = ev.summary || "";

          const start = ev.start.dateTime ? new Date(ev.start.dateTime) : null;
          const end   = ev.end.dateTime   ? new Date(ev.end.dateTime)   : null;

          const format = d =>
            String(d.getHours()).padStart(2, "0") + ":" +
            String(d.getMinutes()).padStart(2, "0");

          let timeLabel = "";
          if (start && end) {
            timeLabel = `${format(start)}–${format(end)}`;
          }

          const displayText = timeLabel
            ? `<time>${timeLabel}</time> ${title}`
            : title;

          const hoverText = timeLabel
            ? `${timeLabel} ${title}`
            : title;

          slots[time].push({
            start: start,
            html: `<div class="event ${color}" data-fulltext="${hoverText}">${displayText}</div>`
          });
        });

        slots["午前"].sort((a, b) => a.start - b.start);
        slots["午後"].sort((a, b) => a.start - b.start);

        const weekdayClass = {
          "日": "w-sun",
          "月": "w-mon",
          "火": "w-tue",
          "水": "w-wed",
          "木": "w-thu",
          "金": "w-fri",
          "土": "w-sat"
        }[weekday];

        const dateCell = `
          <div class="date-cell">
            <div class="date-top">
              ${day}
              <span class="weekday-badge ${weekdayClass}">${weekday}</span>
            </div>
            <div class="date-bottom">${holidayMap[dateStr] || ""}</div>
          </div>
        `;

        let rowClass = "";
        if (holidayMap[dateStr]) rowClass = "holiday";
        else if (weekday === "日") rowClass = "sunday";
        else if (weekday === "土") rowClass = "saturday";

        const isToday = (dateStr === todayStr);

        const tr = document.createElement("tr");
        tr.className = rowClass + (isToday ? " today-row" : "");
        tr.innerHTML = `
          <td>${dateCell}</td>
          <td><div class="event-box">${slots["午前"].map(e => e.html).join("")}</div></td>
          <td><div class="event-box">${slots["午後"].map(e => e.html).join("")}</div></td>
        `;
        table.appendChild(tr);
      }

      table.addEventListener("click", function(e) {
        const eventDiv = e.target.closest(".event");
        if (!eventDiv) return;

        const text = eventDiv.getAttribute("data-fulltext") || eventDiv.textContent;

        const modal = document.getElementById("eventModal");
        modal.textContent = text;
        modal.style.display = "block";

        setTimeout(() => {
          modal.style.display = "none";
        }, 3000);
      });

      container.appendChild(table);

      mergeEventsForMobile();
    }

    async function loadMonth(year, month) {
      const container = document.getElementById("calendarContainer");
      container.innerHTML = `<div class="loading">読み込み中...</div>`;

      const events = await fetchEvents(CALENDAR_ID, year, month);
      const holidayEvents = await fetchEvents(HOLIDAY_CALENDAR_ID, year, month);

      const holidayMap = {};
      holidayEvents.forEach(ev => {
        const date = ev.start.date || ev.start.dateTime.split("T")[0];
        holidayMap[date] = ev.summary;
      });

      renderTable(events, holidayMap, year, month);
    }

    loadMonth(today.getFullYear(), today.getMonth());
    
    // ▼ ここに追加（縦→横、横→縦で再描画する）
    window.addEventListener("orientationchange", () => {
      loadMonth(today.getFullYear(), today.getMonth());
    });
  </script>
</body>
</html>











