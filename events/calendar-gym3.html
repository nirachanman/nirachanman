<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#4a6fa5">

  <title>川口地区社会体育館 日程表</title>

  <style>
  /* =========================================================
     1. テーマ変数
     ========================================================= */
  :root {
    --color-primary: #4a6fa5;
    --color-bg: #f3f4f6;
    --color-white: #ffffff;
    --color-border: #999;

    --color-sat: #f7fbff;
    --color-sun: #fff7f7;
    --color-holiday: #fffdf5;

    --color-badminton: #4caf50;
    --color-tabletennis: #2196f3;
    --color-volleyball: #cca152;
    --color-kids: #9c27b0;
    --color-iwate: #ff69b4;
    --color-cancel: #ed1a3d;
    --color-default: #607d8b;

    --badge-sun: #e57373;
    --badge-sat: #339FF6;
    --badge-weekday: #d1b3ff;
    --badge-holiday: var(--badge-sun);

    --radius: 6px;
    --radius-pill: 20px;
    --shadow: 0 2px 6px rgba(0,0,0,0.15);

    --font-base: 12px;
    --font-small: 11px;
    --font-xs: 10px;
    --font-title: 20px;

    --space-xs: 4px;
    --space-s: 6px;
    --space-m: 12px;
    --space-l: 18px;

    --print-row-height: 35px;
  }

  /* =========================================================
     2. ベース
     ========================================================= */
  body {
    font-family: system-ui, sans-serif;
    margin: 0;
    padding: 0;
    background: var(--color-bg);
  }

  /* PC・スマホ・印刷すべてで中央に表示するタイトル＋当月 */
  .header-center {
    text-align: center;
    font-size: 22px;
    font-weight: 600;
    padding: 10px 0;
    background: var(--color-primary);
    color: var(--color-white);
  }

  /* 祝日テキストを朱色に */
  .holiday-label {
    color: #d9534f !important;
    font-weight: 600;
  }

  .date-bottom {
    color: #d9534f !important;
    font-weight: 600;
  }

  /* =========================================================
     3. レイアウト
     ========================================================= */
  .tabs {
    display: flex;
    gap: var(--space-s);
    padding: var(--space-s);
    overflow-x: auto;
    background: var(--color-white);
    border-bottom: 1px solid var(--color-border);
    position: sticky;
    top: 0;
    z-index: 10;
    scrollbar-gutter: stable;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  }

  .tab {
    padding: 8px 18px;
    border-radius: var(--radius-pill);
    background: #e6e6e6;
    cursor: pointer;
    white-space: nowrap;
    font-size: 14px;
    transition: 0.2s;
  }

  .tab:hover {
    background: #d5d5d5;
  }

  .tab.active {
    background: var(--color-primary);
    color: var(--color-white);
    font-weight: 600;
    box-shadow: var(--shadow);
  }

  /* カレンダー外枠 */
  .calendar-wrapper {
    padding: 6px;
  }

  /* あなたが希望した新しい calendar-box デザイン */
  .calendar-box {
    background: var(--color-primary);
    border-radius: 5px;
    box-shadow: var(--shadow);
    padding: 6px;
    margin: 6px auto;
    max-width: 1000px;
  }

  /* =========================================================
     4. カレンダー（テーブル）
     ========================================================= */
  table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    table-layout: fixed;
  }

  th {
    background: #f5f5f5;
    font-weight: 600;
    padding: var(--space-s);
  }

  th, td {
    border: 1px solid var(--color-border);
    padding: var(--space-xs) var(--space-s);
    font-size: var(--font-base);
    line-height: 1.2;
    white-space: normal;
    min-height: 48px;
  }

  th:nth-child(1), td:nth-child(1) { width: 10%; }
  th:nth-child(2), td:nth-child(2) { width: 35%; }
  th:nth-child(3), td:nth-child(3) { width: 55%; }

  .saturday { background: var(--color-sat); }
  .sunday   { background: var(--color-sun); }
  .holiday  { background: var(--color-holiday); }

  .date-cell {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  .date-top {
    font-size: 20px;
    font-weight: 600;
  }

  .weekday-badge {
    padding: 1px 4px;
    margin-left: 3px;
    border-radius: 8px;
    font-size: 9px;
    color: #fff;
  }

  .w-sun { background: var(--badge-sun); }
  .w-sat { background: var(--badge-sat); }
  .w-mon,
  .w-tue,
  .w-wed,
  .w-thu,
  .w-fri { background: var(--badge-weekday); }

  .holiday .weekday-badge {
    background: var(--badge-holiday) !important;
  }

  .event-box {
    display: flex;
    flex-wrap: wrap;
    gap: 2px 4px;
  }

  .event {
    padding: 2px 6px;
    border-radius: var(--radius);
    color: var(--color-white);
    font-size: var(--font-small);
    line-height: 1.2;
    box-shadow: var(--shadow);
  }

  .event time {
    color:#ffff22;
    font-weight: 700;
  }

  .color-cancel       { background: var(--color-cancel); }
  .color-badminton   { background: var(--color-badminton); }
  .color-tabletennis { background: var(--color-tabletennis); }
  .color-volleyball  { background: var(--color-volleyball); }
  .color-kids        { background: var(--color-kids); }
  .color-iwate       { background: var(--color-iwate); }
  .color-default     { background: var(--color-default); }
  /* =========================================================
     5. スマホ最適化
     ========================================================= */
  @media (max-width: 600px) {

    th:nth-child(2),
    td:nth-child(2),
    th:nth-child(3),
    td:nth-child(3) {
      display: none !important;
    }

    th:nth-child(1),
    td:nth-child(1) {
      width: 20% !important;
    }

    td.merged-events {
      width: 80% !important;
      display: table-cell !important;
      vertical-align: top !important;
    }

    th, td {
      font-size: 16px !important;
      padding: 4px 8px !important;
    }

    .event {
      font-size: 15px !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: flex-start !important;
      padding: 2px 4px !important;
    }

    .event time,
    .event-time {
      color:#ffff22 !important;
      font-weight:600 !important;
    }

    .event-title {
      font-size: 14px !important;
    }

    .weekday-badge {
      font-size: 12px !important;
      padding: 1px 4px !important;
    }

    .event-box {
      column-gap: 1px !important;
      row-gap: 2px !important;
    }

    .tabs {
      position: sticky !important;
      top: 0 !important;
      z-index: 20 !important;
    }
  }

  /* =========================================================
     6. 印刷最適化（タイトル＋当月を中央に統合）
     ========================================================= */
  @media print {

    @page {
      size: A3 portrait;
      margin: 10mm;
    }

    /* タブは印刷しない */
    .tabs {
      display: none !important;
    }

    /* 中央タイトル（PC と同じものを印刷でも使用） */
    .header-center {
      display: block !important;
      text-align: center !important;
      font-size: 20px !important;
      margin-bottom: 4px !important;
      padding: 0 !important;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th, td {
      border: 1px solid #000;
      padding: 3px 4px;
      height: var(--print-row-height);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    :root {
      --print-row-height: 32px;
    }

    .event {
      background: #fff !important;
      color: #000 !important;
      border-radius: 0 !important;
      padding: 2px 4px !important;
      font-size: 11px !important;
      box-shadow: none !important;
    }

    .event time {
      color: #000 !important;
      font-weight: 600 !important;
    }

    /* 祝日テキストは印刷でも朱色のまま */
    .holiday-label,
    .date-bottom {
      color: #d9534f !important;
      font-weight: 600 !important;
    }

    /* バッジは白黒 → 土日祝だけ色復活 */
    .weekday-badge,
    .holiday .weekday-badge {
      background: none !important;
      color: #000 !important;
      border: 1px solid #000 !important;
      padding: 0 3px !important;
      font-size: 10px !important;
    }

    .w-sat {
      background: var(--badge-sat) !important;
      color: #fff !important;
      border: none !important;
    }

    .w-sun {
      background: var(--badge-sun) !important;
      color: #fff !important;
      border: none !important;
    }

    .holiday .weekday-badge {
      background: var(--badge-holiday) !important;
      color: #fff !important;
      border: none !important;
    }

    /* 行背景は白に統一 */
    .saturday,
    .sunday,
    .holiday,
    tr.today-row {
      background: #fff !important;
    }

    * {
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    td .event {
      white-space: normal !important;
      display: block !important;
    }

    td {
      height: auto !important;
    }
  }
  </style>
</head>
<body>

  <!-- PC・スマホ・印刷すべてで中央に表示するタイトル＋当月 -->
  <div class="header-center">
    川口地区社会体育館 日程表（<span id="printMonthHeader"></span>）
  </div>

  <!-- タブ（施設切り替え） -->
  <div class="tabs" id="facilityTabs">
    <div class="tab active" data-facility="gym">体育館</div>
    <div class="tab" data-facility="dojo">武道館</div>
    <div class="tab" data-facility="ground">グラウンド</div>
  </div>

  <!-- カレンダー全体の枠 -->
  <div class="calendar-wrapper">
    <div class="calendar-box">
      <table id="calendarTable">
        <thead>
          <tr>
            <th>日付</th>
            <th>午前</th>
            <th>午後</th>
          </tr>
        </thead>
        <tbody id="calendarBody">
          <!-- JavaScript により自動生成 -->
        </tbody>
      </table>
    </div>
  </div>
<script>
/* =========================================================
   祝日データ（固定）
   ========================================================= */
const holidayMap = {
  "2026-01-01": "元日",
  "2026-01-12": "成人の日",
  "2026-02-11": "建国記念の日",
  "2026-02-23": "天皇誕生日",
  "2026-03-20": "春分の日",
  "2026-04-29": "昭和の日",
  "2026-05-03": "憲法記念日",
  "2026-05-04": "みどりの日",
  "2026-05-05": "こどもの日",
  "2026-07-20": "海の日",
  "2026-08-11": "山の日",
  "2026-09-21": "敬老の日",
  "2026-09-22": "国民の休日",
  "2026-09-23": "秋分の日",
  "2026-10-12": "スポーツの日",
  "2026-11-03": "文化の日",
  "2026-11-23": "勤労感謝の日"
};

/* =========================================================
   イベントデータ（Google Sheets から取得）
   ========================================================= */
let allEvents = [];
let currentFacility = "gym";

async function loadEvents() {
  const url =
    "https://script.google.com/macros/s/AKfycbz2yXk0n1pQnFQ2ymlkY0n4tZ0w-1Yt6c8W9jz0/exec";

  try {
    const res = await fetch(url);
    allEvents = await res.json();
    renderCalendar();
  } catch (e) {
    console.error("イベント取得エラー:", e);
  }
}

/* =========================================================
   カレンダー描画
   ========================================================= */
function renderCalendar() {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();

  loadMonth(year, month);
}

/* =========================================================
   月の描画
   ========================================================= */
function loadMonth(year, month) {
  const tbody = document.getElementById("calendarBody");
  tbody.innerHTML = "";

  // タイトルの当月表示を更新（中央タイトルに反映）
  document.getElementById("printMonthHeader").textContent =
    `${year}年${month + 1}月`;

  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let day = 1; day <= daysInMonth; day++) {
    const dateObj = new Date(year, month, day);
    const weekday = dateObj.getDay();
    const dateStr = dateObj.toISOString().split("T")[0];

    const isHoliday = holidayMap[dateStr] !== undefined;
    const holidayName = holidayMap[dateStr] || "";

    const dayEvents = allEvents.filter(
      ev => ev.date === dateStr && ev.facility === currentFacility
    );

    const amEvents = dayEvents.filter(ev => ev.time === "午前");
    const pmEvents = dayEvents.filter(ev => ev.time === "午後");

    const tr = document.createElement("tr");

    if (weekday === 0) tr.classList.add("sunday");
    if (weekday === 6) tr.classList.add("saturday");
    if (isHoliday) tr.classList.add("holiday");

    /* 日付セル */
    const dateCell = document.createElement("td");
    dateCell.classList.add("date-cell");

    const top = document.createElement("div");
    top.classList.add("date-top");
    top.textContent = day;

    const badge = document.createElement("span");
    badge.classList.add("weekday-badge");

    const badgeClass =
      weekday === 0 ? "w-sun" :
      weekday === 6 ? "w-sat" :
      "w-mon";

    badge.classList.add(badgeClass);
    badge.textContent = ["日","月","火","水","木","金","土"][weekday];

    top.appendChild(badge);
    dateCell.appendChild(top);

    if (isHoliday) {
      const bottom = document.createElement("div");
      bottom.classList.add("date-bottom");
      bottom.textContent = holidayName;
      dateCell.appendChild(bottom);
    }

    tr.appendChild(dateCell);

    /* 午前セル */
    const amCell = document.createElement("td");
    amCell.appendChild(makeEventBox(amEvents));
    tr.appendChild(amCell);

    /* 午後セル */
    const pmCell = document.createElement("td");
    pmCell.appendChild(makeEventBox(pmEvents));
    tr.appendChild(pmCell);

    tbody.appendChild(tr);
  }
}

/* =========================================================
   イベントボックス生成
   ========================================================= */
function makeEventBox(events) {
  const box = document.createElement("div");
  box.classList.add("event-box");

  events.forEach(ev => {
    const div = document.createElement("div");
    div.classList.add("event");

    const colorClass = {
      "中止": "color-cancel",
      "バドミントン": "color-badminton",
      "卓球": "color-tabletennis",
      "バレーボール": "color-volleyball",
      "キッズ": "color-kids",
      "岩手": "color-iwate"
    }[ev.category] || "color-default";

    div.classList.add(colorClass);

    const time = document.createElement("time");
    time.textContent = ev.time;

    const title = document.createElement("span");
    title.classList.add("event-title");
    title.textContent = ev.title;

    div.appendChild(time);
    div.appendChild(title);

    box.appendChild(div);
  });

  return box;
}

/* =========================================================
   タブ切り替え
   ========================================================= */
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");

    currentFacility = tab.dataset.facility;
    renderCalendar();
  });
});

/* =========================================================
   初期ロード
   ========================================================= */
loadEvents();
</script>

</body>
</html>
