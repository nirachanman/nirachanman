<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#f57c00">

  <title>å·å£åœ°åŒºç¤¾ä¼šä½“è‚²é¤¨ æ—¥ç¨‹è¡¨</title>

  <style>
    /* =========================================================
       åŸºæœ¬å¤‰æ•°ï¼ˆãƒ†ãƒ¼ãƒå…¨ä½“ï¼‰
       ========================================================= */
html {
  overflow-y: scroll;
}

    :root {
      --color-primary: #4a6fa5;
      --color-bg: #f3f4f6;
      --color-white: #ffffff;
      --color-border: #999;

      --color-sat: #f7fbff;
      --color-sun: #fff7f7;
      --color-holiday: #fffdf5;

      --color-badminton: #4caf50;
      --color-tabletennis: #2196f3;
      --color-volleyball: #cca152;
      --color-kids: #9c27b0;
      --color-sports: #ff69b4;
      --color-default: #607d8b;

      --badge-sun: #e57373;
      --badge-sat: #339FF6;
      --badge-weekday: #d1b3ff;
      --badge-holiday: var(--badge-sun);

      --radius: 6px;
      --radius-pill: 20px;
      --shadow: 0 1px 2px rgba(0,0,0,0.15);

      --font-base: 12px;
      --font-small: 11px;
      --font-xs: 6px;
      --font-title: 20px;

      --space-xs: 4px;
      --space-s: 6px;
      --space-m: 12px;
      --space-l: 18px;

      --print-row-height: 35px;
    }

    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--color-bg);
    }

    h1 {
      text-align: center;
      padding: var(--space-s);
      margin: 0;
      background: var(--color-primary);
      color: var(--color-white);
      font-size: var(--font-title);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

.header-fixed {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--color-white);
  box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}

    .tabs {
      display: flex;
      gap: var(--space-s);
      padding: var(--space-s);
      overflow-x: auto;
      background: var(--color-white);
      border-bottom: 1px solid var(--color-border);
      position: sticky;
      top: 0;
      z-index: 10;
      position: sticky !important;/* ã‚¿ãƒ–å›ºå®š*/
    }

    .tab {
      padding: 8px 18px;
      border-radius: var(--radius-pill);
      background: #e6e6e6;
      cursor: pointer;
      white-space: nowrap;
      font-size: 14px;
      transition: 0.2s;
    }

    .tab:hover {
      background: #d5d5d5;
    }

    .tab.active {
      background: var(--color-primary);
      color: var(--color-white);
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      background: var(--color-white);
      table-layout: fixed;
      border-radius: var(--radius);
      overflow: hidden;
    }

    th {
      background: #f5f5f5;
      font-weight: 600;
      padding: var(--space-s);
    }

    th, td {
      border: 1px solid var(--color-border);
      padding: var(--space-xs) var(--space-s);
      font-size: var(--font-base);
      line-height: 1.2;
      white-space: normal;
      height: auto;
      min-height: 48px;
    }

    th:nth-child(1), td:nth-child(1) { width: 10%; }
    th:nth-child(2), td:nth-child(2) { width: 35%; }
    th:nth-child(3), td:nth-child(3) { width: 55%; }

    .saturday { background: var(--color-sat); }
    .sunday   { background: var(--color-sun); }
    .holiday  { background: var(--color-holiday); }

    tr.today-row {
      outline: none !important;
      background: none !important;
    }

    .date-cell {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-end;
      text-align: right;
    }

    .date-top {
      font-size: 20px;
      font-weight: 600;
    }

    .date-bottom {
      font-size: var(--font-xs);
      color: #d32f2f;
      margin-top: 2px;
    }

  /* æ›œæ—¥ãƒãƒƒã‚¸ */
  .weekday-badge {
    font-size: 8px !important;
    padding: 1px 6px !important;
  }

/* â–¼ æ›œæ—¥ãƒãƒƒã‚¸ï¼ˆPCãƒ»ã‚¹ãƒãƒ›å…±é€šï¼‰ */
.weekday-badge {
  padding: 1px 6px;
  margin-left: 6px;
  border-radius: 10px;
  font-size: 8px;
  font-weight: 600;
  color: #fff;
}


    .w-sun { background: var(--badge-sun); }
    .w-sat { background: var(--badge-sat); }
    .w-mon,
    .w-tue,
    .w-wed,
    .w-thu,
    .w-fri { background: var(--badge-weekday); }

    .holiday .weekday-badge {
      background: var(--badge-holiday) !important;
    }

    .event-box {
      display: flex;
      flex-wrap: wrap;
      gap: 2px 4px;
    }

    .event {
      padding: 2px 6px;
      border-radius: var(--radius);
      color: var(--color-white);
      font-size: var(--font-small);
      line-height: 1.2;
      white-space: normal;
      box-shadow: var(--shadow);
    }

    .event time {
      color:#ffff22;
      font-weight: 700;
    }

    .color-badminton   { background: var(--color-badminton); }
    .color-tabletennis { background: var(--color-tabletennis); }
    .color-volleyball  { background: var(--color-volleyball); }
    .color-kids        { background: var(--color-kids); }
    .color-sports       { background: var(--color-sports); }
    .color-default     { background: var(--color-default); }

/* =========================================================
   â–¼ ã‚¹ãƒãƒ›ç¸¦å‘ãï¼ˆåˆå‰ãƒ»åˆå¾Œ â†’ 1åˆ—ã«çµ±åˆï¼‰
   ========================================================= */
@media (max-width: 600px) {

  /* åˆå‰ãƒ»åˆå¾Œã®åˆ—ã‚’éè¡¨ç¤ºã«ã—ã¦1åˆ—åŒ– */
  th:nth-child(2),
  td:nth-child(2),
  th:nth-child(3),
  td:nth-child(3) {
    display: none !important;
  }

  /* æ—¥ä»˜åˆ—ï¼ˆå·¦å´ï¼‰ */
  th:nth-child(1),
  td:nth-child(1) {
    width: 20% !important;
    display: table-cell !important;
  }

  /* ã‚¤ãƒ™ãƒ³ãƒˆåˆ—ï¼ˆå³å´ï¼‰ */
  td.merged-events {
    width: 80% !important;
    display: table-cell !important;
    vertical-align: top !important;
  }

  /* ã‚»ãƒ«å…¨ä½“ã®ä½™ç™½ã¯ã‚¼ãƒ­ã«ã—ã¦å½±éŸ¿ã‚’æ¶ˆã™ */
  th,
  td {
    font-size: 16px !important;
    padding: 4px 8px !important;
    line-height: 1.2 !important;
  }

  /* ã‚¤ãƒ™ãƒ³ãƒˆæœ¬ä½“ï¼šã“ã“ã«ä½™ç™½ã‚’ä¸€æœ¬åŒ– */
  .event {
    font-size: 15px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    padding: 2px 4px 2px 4px !important; /* ä¸Š4px å³6px ä¸‹4px å·¦6px â†’ å·¦å³ãŒåŒã˜ */
  }

  /* æ™‚é–“ï¼ˆå¿…ãšé»„è‰²ãƒ»ä¸‹ã ã‘å°‘ã—ä½™ç™½ï¼‰ */
  .event time {
    display: block !important;
    font-weight: 700 !important;
    margin: 0 0 2px 0 !important;
    color: #ffff22 !important;
  }

  /* ã‚¿ã‚¤ãƒˆãƒ« */
  .event-title {
    font-size: 14px !important;
  }


  /* ã‚¤ãƒ™ãƒ³ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼šgap ã¯ã™ã¹ã¦ã‚¼ãƒ­ã«ã—ã¦ä¸çµ±ä¸€è¦å› ã‚’æ¶ˆã™ */
  .event-box {
    display: flex !important;
    flex-wrap: wrap !important;
    column-gap: 1px !important; /* â† å·¦å³ã¯ã‚¼ãƒ­ã®ã¾ã¾ï¼ˆå·¦ä½™ç™½ã¯ .event ã§çµ±ä¸€ï¼‰ */
    row-gap: 2px !important; /* â† ä¸Šä¸‹ã®é–“éš”ï¼ˆãŠå¥½ã¿ã§èª¿æ•´å¯ï¼‰ */
  }

  .switch-btn {
    font-size: 18px !important;   /* æ–‡å­—ã‚’å¤§ãã */
    padding: 8px 12px !important; /* ãƒœã‚¿ãƒ³è‡ªä½“ã‚’å¤§ãã */
    height: auto !important;       /* å›ºå®šé«˜ã•ã‚’è§£é™¤ */
  }
}

        /* å°åˆ·ç”¨ï¼ˆã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼‰ */
    @media print {

      @page {
        size: A3 portrait;
        margin: 10mm;
      }

      .tabs {
        display: none !important;
      }

      h1 {
        display: block !important;
        margin-bottom: 6px;
      }

      th:nth-child(1), td:nth-child(1) { width: 10% !important; }
      th:nth-child(2), td:nth-child(2) { width: 40% !important; }
      th:nth-child(3), td:nth-child(3) { width: 50% !important; }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }

      th, td {
        border: 1px solid #000;
        padding: 3px 4px;
        height: var(--print-row-height);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .event {
        background: #fff !important;
        color: #000 !important;
        border-radius: 0;
        padding: 2px 4px;
      }

      .event time {
        color: #000 !important;
      }

      .saturday,
      .sunday,
      .holiday,
      tr.today-row {
        background: #fff !important;
      }

      .weekday-badge {
        background: none !important;
        color: #000 !important;
        border: 1px solid #000;
      }

      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      td .event {
        white-space: normal !important;
        display: block;
      }

      td {
        height: auto !important;
      }

      .holiday .weekday-badge {
        background: none !important;
        color: #000 !important;
        border: 1px solid #000 !important;
      }

/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³å…¨ä½“ */
.calendar-switch {
  display: flex;
  gap: 10px;
  margin: 10px 0 15px;
}

/* ãƒœã‚¿ãƒ³ã®åŸºæœ¬ãƒ‡ã‚¶ã‚¤ãƒ³ */
.switch-btn {
  flex: 1;
  padding: 10px 0;
  font-size: 16px;
  font-weight: 600;
  border-radius: 8px;
  border: 2px solid #ccc;
  background: #f5f5f5;
  cursor: pointer;
  transition: 0.2s;
}

/* è¨­å®šç„¡åŠ¹â–¼ ä½“è‚²é¤¨ / å…¬æ°‘é¤¨ / åˆ¥é¤¨ ã®ã‚¿ãƒ–ã‚’å¤§ããã™ã‚‹
.switch-btn {
  padding: 10px 20px !important;   /* â† é«˜ã•ã¨æ¨ªå¹…ã‚’å¢—ã‚„ã™ */
  font-size: 20px !important;      /* â† æ–‡å­—ã‚’å¤§ãã */
  border-radius: 10px !important;  /* â† ãƒœã‚¿ãƒ³ã®ä¸¸ã¿ã‚‚èª¿æ•´ */
  font-weight: 700 !important;     /* â† å¤ªå­—ã§è¦‹ã‚„ã™ã */
}

/* ãƒ›ãƒãƒ¼æ™‚ */
.switch-btn:hover {
  background: #e8e8e8;
}

/* é¸æŠä¸­ã®ãƒœã‚¿ãƒ³ */
.switch-btn.active {
  background: #0078d4;
  color: white;
  border-color: #005a9e;
}
  }
 /* å…¬æ°‘é¤¨ï¼šé’ç³»ãƒ†ãƒ¼ãƒ */
.kouminkan-mode .event {
  background: #e6f0ff !important;   /* å„ªã—ã„è–„é’ */
  border-left: 6px solid #1e88e5 !important; /* é’ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
  color: #0d47a1 !important;        /* èª­ã¿ã‚„ã™ã„æ¿ƒé’ */
}

.kouminkan-mode .event time {
  color: #ffff22 !important;        /* æ™‚é–“è¡¨ç¤º */
}

.kouminkan-mode .switch-btn.active {
  background: #1565c0 !important;   /* æ¿ƒã„é’ */
  border-color: #0d47a1 !important;
  color: #fff !important;
}

/* ä½“è‚²é¤¨ï¼šç·‘ç³»ãƒ†ãƒ¼ãƒ */
.gym-mode .event {
  background: #dff5e1 !important;   /* å„ªã—ã„è–„ç·‘ */
  border-left: 6px solid #4caf50 !important; /* ç·‘ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
  color: #1b5e20 !important;        /* èª­ã¿ã‚„ã™ã„æ¿ƒç·‘ */
}

.gym-mode .event time {
  color: #0d5302 !important;        /* æ·±ã„ç·‘ã®æ™‚é–“è¡¨ç¤º */
}

.gym-mode .switch-btn.active {
  background: #2e7d32 !important;   /* æ¿ƒã„ç·‘ */
  border-color: #1b5e20 !important;
  color: #fff !important;
}

/* åˆ¥é¤¨ï¼šã‚ªãƒ¬ãƒ³ã‚¸ç³»ãƒ†ãƒ¼ãƒ */
.bekkan-mode .event {
  background: #fff2e0 !important;   /* å„ªã—ã„è–„ã‚ªãƒ¬ãƒ³ã‚¸ */
  border-left: 6px solid #fb8c00 !important; /* ã‚ªãƒ¬ãƒ³ã‚¸ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
  color: #e65100 !important;        /* èª­ã¿ã‚„ã™ã„æ¿ƒã‚ªãƒ¬ãƒ³ã‚¸ */
}

.bekkan-mode .event time {
  color: #bf360c !important;        /* æ·±ã„ã‚ªãƒ¬ãƒ³ã‚¸ã®æ™‚é–“è¡¨ç¤º */
}

.bekkan-mode .switch-btn.active {
  background: #ef6c00 !important;   /* æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸ */
  border-color: #e65100 !important;
  color: #fff !important;
}

.pc-only { display: table-cell; }
.sp-only { display: none; }

@media (max-width: 600px) {
  .pc-only { display: none !important; }
  .sp-only { display: table-cell !important; }
}


/* â–¼ ç¥æ—¥åï¼ˆå°ã•ãæ§ãˆã‚ï¼‰ */
.holiday-label {
  font-size: 8px !important;
  color: #d32f2f;
  opacity: 0.85;
  margin-top: 4px;
}

/* â–¼ è¡Œå…¨ä½“ã®è‰²ï¼ˆPCãƒ»ã‚¹ãƒãƒ›å…±é€šï¼‰ */
tr.saturday {
  background: #f0f7ff !important; /* è–„ã„é’ */
}

tr.sunday {
  background: #fff0f0 !important; /* è–„ã„èµ¤ */
}

tr.holiday {
  background: #fff8e1 !important; /* è–„ã„é»„è‰² */
}

/* â–¼ Webãƒšãƒ¼ã‚¸ã§ã¯éè¡¨ç¤º */
#printMonthTitle {
  display: none;
}

/* â–¼ å°åˆ·æ™‚ã ã‘è¡¨ç¤º */
@media print {
  #printMonthTitle {
    display: block !important;
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 8px;
  }
}

/* â–¼ æœˆé¸æŠã‚¿ãƒ–ã‚’å°ã•ãã™ã‚‹ */
#monthTabs .tab {
  padding: 4px 10px !important;   /* å°ã•ã‚ã®ä½™ç™½ */
  font-size: 12px !important;     /* æ–‡å­—ã‚µã‚¤ã‚ºã‚’å°ã•ã */
  border-radius: 12px !important; /* ä¸¸ã¿ã‚‚å°‘ã—å°ã•ã */
  flex: 0 0 auto !important;      /* å¹…ãŒåºƒãŒã‚‰ãªã„ã‚ˆã†ã« */
}

  </style>
</head>

<body>

  <div class="header-fixed">

    <h1>ä½“è‚²é¤¨ å…¬æ°‘é¤¨ åˆ¥é¤¨ æ—¥ç¨‹è¡¨</h1>

    <!-- â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
    <div id="calendarSwitchTabs" class="calendar-switch">
      <button class="switch-btn active" data-cal="kouminkan">å…¬æ°‘é¤¨</button>
      <button class="switch-btn" data-cal="gym">ä½“è‚²é¤¨</button>
      <button class="switch-btn" data-cal="bekkan">åˆ¥é¤¨</button>
    </div>

    <!-- â–¼ æœˆã‚¿ãƒ– -->
    <div id="monthTabs" class="tabs month-tabs"></div>

  </div> <!-- /header-fixed -->

  <!-- â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ -->
  <div id="printMonthTitle" class="print-title"></div>
  <div id="calendarContainer"></div>

<script>
/* =========================================================
   â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚»ãƒƒãƒˆï¼ˆè¤‡æ•°å¯¾å¿œï¼‰
   ========================================================= */
/* â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚»ãƒƒãƒˆ */
const CALENDAR_SETS = {
  kouminkan: [
    "31492fb4b39fef411514fef1378eaf68f176de53432052015b21a14223757e1d@group.calendar.google.com"
  ],
  gym:[
    "c15c3451e52f787202dca97fbd0e35c908d5972611deb534d78c8f6b46262895@group.calendar.google.com"
  ],
  bekkan: [ 
"kawaguchi.public.hall.annex@gmail.com" 
  ]
};

let currentCalendarSet = "kouminkan";  // åˆæœŸè¡¨ç¤ºã¯å…¬æ°‘é¤¨

const HOLIDAY_CALENDAR_ID = "japanese__ja@holiday.calendar.google.com";
const API_KEY = "AIzaSyA5YSgL1PG9e61Nk7b-SbPV99XMvHeGGtI";
const WEEKDAYS = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];

const today = new Date();
const todayStr = today.toISOString().split("T")[0];

let currentYear = today.getFullYear();
let currentMonth = today.getMonth();

/* =========================================================
   â–¼ æœˆã‚¿ãƒ–ç”Ÿæˆ
   ========================================================= */
function createMonthTabs() {
  const tabArea = document.getElementById("monthTabs");
  tabArea.innerHTML = "";

  for (let i = -1; i <= 12; i++) {
    const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
    const label = `${d.getMonth() + 1}æœˆ`;

    const tab = document.createElement("div");
    tab.className = "tab" + (d.getMonth() === currentMonth ? " active" : "");
    tab.textContent = label;

    tab.onclick = () => {
      currentYear = d.getFullYear();
      currentMonth = d.getMonth();

      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");

      loadMonth(currentYear, currentMonth);
    };

    tabArea.appendChild(tab);
  }
}

/* =========================================================
   â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
   ========================================================= */
function setupCalendarSwitch() {
  document.querySelectorAll(".switch-btn").forEach(btn => {
    btn.onclick = () => {
      // ãƒœã‚¿ãƒ³ã® active åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll(".switch-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // ç¾åœ¨ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚»ãƒƒãƒˆã‚’æ›´æ–°
      currentCalendarSet = btn.dataset.cal;

      // â–¼ ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’ä¸€åº¦å‰Šé™¤ï¼ˆé‡è¦ï¼‰
      document.body.classList.remove("kouminkan-mode", "gym-mode", "bekkan-mode");

      // â–¼ é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã®ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
      if (currentCalendarSet === "gym") {
        document.body.classList.add("gym-mode");
      } else if (currentCalendarSet === "kouminkan") {
        document.body.classList.add("kouminkan-mode");
      } else if (currentCalendarSet === "bekkan") {
        document.body.classList.add("bekkan-mode");
      }

      // æœˆã‚’å†èª­ã¿è¾¼ã¿
      loadMonth(currentYear, currentMonth);
    };
  });
}

/* =========================================================
   â–¼ Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ API èª­ã¿è¾¼ã¿
   ========================================================= */
async function fetchEvents(calendarId, year, month) {
  const start = new Date(year, month, 1).toISOString();
  const end = new Date(year, month + 1, 1).toISOString();

  const url =
    `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events` +
    `?key=${API_KEY}&timeMin=${start}&timeMax=${end}` +
    `&singleEvents=true&orderBy=startTime`;

  const res = await fetch(url);
  const data = await res.json();
  return data.items || [];
}

/* â–¼ è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ã¾ã¨ã‚ã¦èª­ã¿è¾¼ã‚€ */
async function fetchAllEvents(year, month) {
  let all = [];
  const ids = CALENDAR_SETS[currentCalendarSet];

  for (const id of ids) {
    const items = await fetchEvents(id, year, month);
    all = all.concat(items);
  }

  return all;
}

/* =========================================================
   â–¼ åˆå‰ãƒ»åˆå¾Œåˆ†é¡ãªã©ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼‰
   ========================================================= */
function classifyTime(ev) {
  if (!ev.start.dateTime) return "åˆå‰";
  const hour = new Date(ev.start.dateTime).getHours();
  return hour < 12 ? "åˆå‰" : "åˆå¾Œ";
}

function detectColor(title) {
  if (title.includes("ğŸ¸")) return "color-badminton";
  if (title.includes("ğŸ“")) return "color-tabletennis";
  if (title.includes("ğŸ")) return "color-volleyball";
  if (title.includes("ğŸ‘§")) return "color-kids";
  if (title.includes("âš½")) return "color-sports";
  return "color-default";
}

/* =========================================================
   â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»ï¼ˆã‚ãªãŸã®æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼‰
   ========================================================= */
function renderTable(events, holidayMap, year, month) {
  const container = document.getElementById("calendarContainer");
  container.innerHTML = "";

  const table = document.createElement("table");
  table.innerHTML = `
    <tr>
      <th>æ—¥</th>
      <th class="pc-only">åˆå‰</th>
      <th class="pc-only">åˆå¾Œ</th>
      <th class="sp-only">äºˆå®š</th>
    </tr>
  `;

  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let day = 1; day <= daysInMonth; day++) {
    const dateObj = new Date(year, month, day);
    const weekday = WEEKDAYS[dateObj.getDay()];
    const dateStr =
      `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;

    const dayEvents = events.filter(ev => {
      const d = ev.start.date || ev.start.dateTime.split("T")[0];
      return d === dateStr;
    });

    const slots = { "åˆå‰": [], "åˆå¾Œ": [] };

    dayEvents.forEach(ev => {
      const time = classifyTime(ev);
      const color = detectColor(ev.summary || "");
      const title = ev.summary || "";

      const start = ev.start.dateTime ? new Date(ev.start.dateTime) : null;
      const end   = ev.end.dateTime   ? new Date(ev.end.dateTime)   : null;

      const format = d =>
        String(d.getHours()).padStart(2, "0") + ":" +
        String(d.getMinutes()).padStart(2, "0");

      let timeLabel = "";
      if (start && end) {
        timeLabel = `${format(start)}â€“${format(end)}`;
      }

      const displayText = timeLabel
        ? `<time>${timeLabel}</time> ${title}`
        : title;

      slots[time].push({
        start: start,
        html: `<div class="event ${color}">${displayText}</div>`
      });
    });

    slots["åˆå‰"].sort((a, b) => a.start - b.start);
    slots["åˆå¾Œ"].sort((a, b) => a.start - b.start);

    /* â–¼ æ›œæ—¥ãƒãƒƒã‚¸ã®è‰²ã‚¯ãƒ©ã‚¹ */
    const weekdayClass = {
      "æ—¥": "w-sun",
      "æœˆ": "w-mon",
      "ç«": "w-tue",
      "æ°´": "w-wed",
      "æœ¨": "w-thu",
      "é‡‘": "w-fri",
      "åœŸ": "w-sat"
    }[weekday];

    /* â–¼ æ—¥ä»˜ã‚»ãƒ«ï¼ˆPCãƒ»ã‚¹ãƒãƒ›å…±é€šï¼‰ */
    const dateCell = `
      <div class="date-cell">
        <div class="date-top">
          ${day}
          <span class="weekday-badge ${weekdayClass}">${weekday}</span>
        </div>
        <div class="date-bottom">
          ${holidayMap[dateStr] ? `<span class="holiday-label">${holidayMap[dateStr]}</span>` : ""}
        </div>
      </div>
    `;

    /* â–¼ è¡Œã®è‰²ã‚¯ãƒ©ã‚¹ */
    let rowClass = "";
    if (holidayMap[dateStr]) rowClass = "holiday";
    else if (weekday === "æ—¥") rowClass = "sunday";
    else if (weekday === "åœŸ") rowClass = "saturday";

    /* â–¼ ã‚¹ãƒãƒ›ç”¨ï¼šåˆå‰ï¼‹åˆå¾Œã‚’çµ±åˆ */
    const mergedHTML =
      slots["åˆå‰"].map(e => e.html).join("") +
      slots["åˆå¾Œ"].map(e => e.html).join("");

    const tr = document.createElement("tr");
    tr.className = rowClass + (dateStr === todayStr ? " today-row" : "");

    tr.innerHTML = `
      <td>${dateCell}</td>

      <td class="pc-only">
        <div class="event-box">${slots["åˆå‰"].map(e => e.html).join("")}</div>
      </td>

      <td class="pc-only">
        <div class="event-box">${slots["åˆå¾Œ"].map(e => e.html).join("")}</div>
      </td>

      <td class="sp-only">
        <div class="event-box">${mergedHTML}</div>
      </td>
    `;

    table.appendChild(tr);
  }

  container.appendChild(table);
}

/* =========================================================
   â–¼ æœˆèª­ã¿è¾¼ã¿ï¼ˆè¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œï¼‰
   ========================================================= */
async function loadMonth(year, month) {
  const container = document.getElementById("calendarContainer");
  container.innerHTML = `<div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>`;

  const events = await fetchAllEvents(year, month);
  const holidayEvents = await fetchEvents(HOLIDAY_CALENDAR_ID, year, month);

  const holidayMap = {};
  holidayEvents.forEach(ev => {
    const date = ev.start.date || ev.start.dateTime.split("T")[0];
    holidayMap[date] = ev.summary;
  });

  renderTable(events, holidayMap, year, month);

  // â–¼ å°åˆ·ç”¨ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå½“æœˆï¼‰
  const title = document.getElementById("printMonthTitle");
  if (title) {
    title.textContent = `${year}å¹´ ${month + 1}æœˆ`;
  }
}

/* =========================================================
   â–¼ åˆæœŸåŒ–
   ========================================================= */
createMonthTabs();
setupCalendarSwitch();
loadMonth(currentYear, currentMonth);

</script>

</body>
</html>





