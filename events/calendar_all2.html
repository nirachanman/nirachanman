<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æ—¥ç¨‹è¡¨</title>

  <style>
    :root {
      --color-primary: #4a6fa5;
      --color-bg: #f3f4f6;
      --color-white: #ffffff;
      --color-border: #999;

      --cal1-color: #4a6fa5;
      --cal2-color: #0d8a6a;
      --cal3-color: #c47c08;
      --calAll-color: #6b7280;

      --radius-pill: 30px;
      --shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--color-bg);
    }

    /* ä¸Šéƒ¨ã‚¿ãƒ–è¡Œï¼ˆæ–½è¨­é¸æŠï¼‰ */
    .top-bar {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      background: var(--color-white);
      border-bottom: 1px solid var(--color-border);
      overflow-x: auto;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .cal-tab {
      padding: 6px 16px;
      border-radius: var(--radius-pill);
      background: #e5e7eb;
      cursor: pointer;
      white-space: nowrap;
      font-size: 14px;
      box-shadow: var(--shadow);
      transition: 0.25s;
    }

    .cal-tab.active {
      background: var(--color-primary);
      color: #fff;
      font-weight: 600;
      transform: translateY(-2px);
    }

    .show-all-btn {
      margin-left: auto;
      padding: 6px 16px;
      background: var(--color-primary);
      color: #fff;
      border-radius: var(--radius-pill);
      cursor: pointer;
      font-size: 14px;
      box-shadow: var(--shadow);
      white-space: nowrap;
    }

    /* æœˆã‚¿ãƒ– */
    .tabs {
      display: flex;
      gap: 4px;
      padding: 4px 6px;
      overflow-x: auto;
      background: var(--color-white);
      border-bottom: 1px solid var(--color-border);
      position: sticky;
      top: 48px;
      z-index: 999;
    }

    .tab {
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      background: #e6e6e6;
      cursor: pointer;
      white-space: nowrap;
      font-size: 13px;
    }

    .tab.active {
      background: var(--color-primary);
      color: var(--color-white);
      font-weight: 600;
      transform: translateY(-2px);
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é ˜åŸŸ */
    .calendar-wrapper {
      padding: 10px;
    }

    .calendar-box {
      margin-bottom: 20px;
      padding: 10px;
      background: #fff;
      border-radius: 10px;
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--color-white);
      table-layout: fixed;
    }

    th, td {
      border: 1px solid var(--color-border);
      padding: 4px 6px;
      font-size: 12px;
      line-height: 1.2;
    }

    /* åˆ—å¹…ï¼ˆPCï¼‰ */
    th:nth-child(1), td:nth-child(1) { width: 10% !important; }
    th:nth-child(2), td:nth-child(2) { width: 35% !important; }
    th:nth-child(3), td:nth-child(3) { width: 55% !important; }

    /* ã‚¹ãƒãƒ›åˆ—å¹… */
    @media (max-width: 600px) {
      th:nth-child(1), td:nth-child(1) { width: 18% !important; }
    }

    /* æ—¥ä»˜ã‚»ãƒ« */
    .date-cell {
      text-align: right;
      font-weight: 600;
      font-size: 14px;
    }

.day-number {
  font-family: "Roboto Mono", "Courier New", monospace;

}

/* æœ¬æ—¥å¼·èª¿ï¼ˆç”»é¢è¡¨ç¤ºã®ã¿ï¼‰ */
.today-highlight td {
  background: #fef9c3 !important; /* æŸ”ã‚‰ã‹ã„é»„è‰² */
  border-color: #facc15 !important;
}

    /* ç¥æ—¥å */
.holiday-name {
  display: inline-block;
  padding: 1px 4px;        /* â† ä½™ç™½ã‚’å°ã•ã */
  background: #fca5a5;     /* æŸ”ã‚‰ã‹ã„èµ¤ï¼ˆãã®ã¾ã¾ï¼‰ */
  color: #7f1d1d;          /* æ·±ã„èµ¤æ–‡å­— */
  font-size: 8px;          /* â† å°ã•ã‚ã«å¤‰æ›´ */
  font-weight: 400;
  border-radius: 6px;      /* â† è§’ä¸¸ã‚‚å°‘ã—å°ã•ã */
  margin-top: 2px;
}

    /* æ›œæ—¥æ–‡å­—è‰² */
    .weekday-sun { color: #e11d48 !important; }
    .weekday-sat { color: #2563eb !important; }
    .weekday-holiday { color: #d97706 !important; }

    /* è¡ŒèƒŒæ™¯è‰² */
    .row-sun { background: #fff1f2 !important; }
    .row-sat { background: #eff6ff !important; }
    .row-holiday { background: #fff7ed !important; }

    /* ã‚¤ãƒ™ãƒ³ãƒˆ */
    .event-box {
      display: flex;
      flex-wrap: wrap;
      gap: 2px 4px;
    }

    .event {
      padding: 2px 6px;
      border-radius: 6px;
      color: #fff;
      font-size: 11px;
      font-weight: 400 !important;
    }

    .event time {
      color: #ffff22;
      font-weight: 600;
    }

.google-cal-btn {
  padding: 6px 16px;
  background: #4285f4;        /* Googleãƒ–ãƒ«ãƒ¼ */
  color: #fff;
  border-radius: var(--radius-pill);
  font-size: 14px;
  text-decoration: none;
  white-space: nowrap;
  box-shadow: var(--shadow);
  margin-left: 6px;
  display: inline-block;
  transition: 0.2s;
}

.google-cal-btn:hover {
  background: #357ae8;
}

    /* PC/ã‚¹ãƒãƒ›åˆ‡æ›¿ */
    .pc-only { display: table-cell; }
    .sp-only { display: none; }

    @media (max-width: 600px) {
      .pc-only { display: none !important; }
      .sp-only { display: table-cell !important; }
    }

@media print {

  /* æ–‡å­—ã¯ã™ã¹ã¦é»’ã«çµ±ä¸€ */
  * {
    color: #000 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* æ›œæ—¥è‰²ã‚¯ãƒ©ã‚¹ã‚‚é»’ã«ä¸Šæ›¸ã */
  .weekday-sun,
  .weekday-sat,
  .weekday-holiday {
    color: #000 !important;
  }

  /* è¡ŒèƒŒæ™¯è‰²ã¯æ®‹ã™ï¼ˆã“ã“ãŒé‡è¦ï¼‰ */
  .row-sun    { background: #fff1f2 !important; } /* æ—¥æ›œï¼šæ·¡ã„èµ¤ */
  .row-sat    { background: #eff6ff !important; } /* åœŸæ›œï¼šæ·¡ã„é’ */
  .row-holiday{ background: #fff7ed !important; } /* ç¥æ—¥ï¼šæ·¡ã„æ©™ */

  /* ãã‚Œä»¥å¤–ã®èƒŒæ™¯è‰²ã¯æ¶ˆã™ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆè‰²ãƒ»ç¥æ—¥ãƒ©ãƒ™ãƒ«ãªã©ï¼‰ */
  .event,
  .holiday-name,
  .calendar-box,
  table,
  th,
  td {
    background: #fff !important;
  }

  /* è¡ŒèƒŒæ™¯è‰²ã®ä¸Šæ›¸ãã‚’é˜²ããŸã‚ã€è¡ŒèƒŒæ™¯æŒ‡å®šã‚’æœ€å¾Œã«å†åº¦é©ç”¨ */
  tr.row-sun    td { background: #fff1f2 !important; }
  tr.row-sat    td { background: #eff6ff !important; }
  tr.row-holiday td { background: #fff7ed !important; }
}

@media print {
  .today-highlight td {
    background: #fff !important;
    border-color: #999 !important;
  }
}

  </style>
</head>

<body>

<div class="top-bar">
  <div class="cal-tab active" data-cal="1">ğŸ› å…¬æ°‘é¤¨</div>
  <div class="cal-tab" data-cal="2">ğŸŸ ä½“è‚²é¤¨</div>
  <div class="cal-tab" data-cal="3">ğŸ¢ åˆ¥é¤¨</div>

  <div class="show-all-btn" id="showAllBtn">ğŸ“… å…¨ã¦è¡¨ç¤º</div>

  <a href="https://calendar.google.com" target="_blank" class="google-cal-btn">
    ğŸ”— Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
  </a>
</div>

<div class="tabs" id="monthTabs"></div>

<div id="calendarContainer" class="calendar-wrapper">
  <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
</div>

<script>
let CURRENT_CALENDAR = 1;

const CALENDAR_IDS = {
  1: "31492fb4b39fef411514fef1378eaf68f176de53432052015b21a14223757e1d@group.calendar.google.com",
  2: "c15c3451e52f787202dca97fbd0e35c908d5972611deb534d78c8f6b46262895@group.calendar.google.com",
  3: "kawaguchi.public.hall.annex@gmail.com"
};

const CALENDAR_NAMES = {
  1: "å…¬æ°‘é¤¨",
  2: "ä½“è‚²é¤¨",
  3: "åˆ¥é¤¨"
};

const CALENDAR_COLORS = {
  1: "var(--cal1-color)",
  2: "var(--cal2-color)",
  3: "var(--cal3-color)",
  all: "var(--calAll-color)"
};

const FACILITY_COLOR = {
  "å…¬æ°‘é¤¨": "var(--cal1-color)",
  "ä½“è‚²é¤¨": "var(--cal2-color)",
  "åˆ¥é¤¨": "var(--cal3-color)"
};

const HOLIDAY_CALENDAR_ID = "japanese__ja@holiday.calendar.google.com";
const API_KEY = "AIzaSyA5YSgL1PG9e61Nk7b-SbPV99XMvHeGGtI";

const WEEKDAYS = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
const today = new Date();

/* æœˆã‚¿ãƒ–ç”Ÿæˆ */
const months = [];
for (let i = -1; i <= 12; i++) {
  const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
  months.push({ label: `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ`, year: d.getFullYear(), month: d.getMonth() });
}

const tabArea = document.getElementById("monthTabs");
months.forEach((m, idx) => {
  const tab = document.createElement("div");
  tab.className = "tab" + (idx === 1 ? " active" : "");
  tab.textContent = m.label;
  tab.onclick = () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    loadMonth(m.year, m.month);
  };
  tabArea.appendChild(tab);
});

/* æ–½è¨­ã‚¿ãƒ–åˆ‡æ›¿ */
document.querySelectorAll(".cal-tab").forEach(tab => {
  tab.addEventListener("click", () => {
    const cal = Number(tab.dataset.cal);
    CURRENT_CALENDAR = cal;

    document.querySelectorAll(".cal-tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");

    const color = CALENDAR_COLORS[cal];
    document.documentElement.style.setProperty("--color-primary", color);
    document.body.style.background = color + "22";

    const activeTab = document.querySelector("#monthTabs .active");
    const [year, month] = activeTab.textContent.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);
    loadMonth(year, month - 1);
  });
});

/* Google Calendar API */
async function fetchEvents(calendarId, year, month) {
  const start = new Date(year, month, 1).toISOString();
  const end = new Date(year, month + 1, 1).toISOString();

  const url =
    `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events` +
    `?key=${API_KEY}&timeMin=${start}&timeMax=${end}` +
    `&singleEvents=true&orderBy=startTime`;

  const res = await fetch(url);
  const data = await res.json();
  return data.items || [];
}

/* åˆå‰/åˆå¾Œåˆ†é¡ */
function classifyTime(ev) {
  if (!ev.start.dateTime) return "åˆå‰";
  const hour = new Date(ev.start.dateTime).getHours();
  return hour < 12 ? "åˆå‰" : "åˆå¾Œ";
}

/* ãƒ†ãƒ¼ãƒ–ãƒ«æç”» */
function renderTable(events, holidayMap, year, month, title, themeColor) {
  const box = document.createElement("div");
  box.className = "calendar-box";

  const table = document.createElement("table");
  table.innerHTML = `
    <tr>
      <th>${title}</th>
      <th class="pc-only">åˆå‰</th>
      <th class="pc-only">åˆå¾Œ</th>
      <th class="sp-only">ã‚¤ãƒ™ãƒ³ãƒˆ</th>
    </tr>
  `;

  const days = new Date(year, month + 1, 0).getDate();

  for (let day = 1; day <= days; day++) {
    const dateObj = new Date(year, month, day);
    const weekday = WEEKDAYS[dateObj.getDay()];
    const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;

    const dayEvents = events.filter(ev => {
      const d = ev.start.date || (ev.start.dateTime ? ev.start.dateTime.split("T")[0] : "");
      return d === dateStr;
    });

    const slots = { "åˆå‰": [], "åˆå¾Œ": [] };

    dayEvents.forEach(ev => {
      const time = classifyTime(ev);
      const title = ev.summary || "";

      const start = ev.start.dateTime ? new Date(ev.start.dateTime) : null;
      const end   = ev.end.dateTime   ? new Date(ev.end.dateTime)   : null;

      const format = d => `${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
      let timeLabel = "";
      if (start && end) timeLabel = `${format(start)}â€“${format(end)}`;

      const displayText = timeLabel ? `<time>${timeLabel}</time> ${title}` : title;

      const eventColor = ev._facility
        ? FACILITY_COLOR[ev._facility]
        : themeColor;

      slots[time].push({
        start,
        html: `<div class="event" style="background:${eventColor}">${displayText}</div>`
      });
    });

    slots["åˆå‰"].sort((a,b)=> (a.start || 0) - (b.start || 0));
    slots["åˆå¾Œ"].sort((a,b)=> (a.start || 0) - (b.start || 0));

    const merged = [...slots["åˆå‰"], ...slots["åˆå¾Œ"]].sort(
      (a,b)=> (a.start || 0) - (b.start || 0)
    );

    const holidayName = holidayMap[dateStr]
      ? `<div class="holiday-name">${holidayMap[dateStr]}</div>`
      : "";

    const isPC = window.innerWidth > 600;

    /* æ›œæ—¥ã‚¯ãƒ©ã‚¹ */
    let weekdayClass = "";
    if (holidayMap[dateStr]) weekdayClass = "weekday-holiday";
    else if (weekday === "æ—¥") weekdayClass = "weekday-sun";
    else if (weekday === "åœŸ") weekdayClass = "weekday-sat";

const tr = document.createElement("tr");

// ä»Šæ—¥ãªã‚‰å¼·èª¿ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã‚‹
const isToday =
  dateObj.getFullYear() === today.getFullYear() &&
  dateObj.getMonth() === today.getMonth() &&
  dateObj.getDate() === today.getDate();

if (isToday) tr.classList.add("today-highlight");

    /* è¡ŒèƒŒæ™¯è‰² */
    if (holidayMap[dateStr]) tr.className = "row-holiday";
    else if (weekday === "æ—¥") tr.className = "row-sun";
    else if (weekday === "åœŸ") tr.className = "row-sat";

    tr.innerHTML = `
      <td>
        <div class="date-cell">
          <span class="day-number ${weekdayClass}">${day}</span>
          <span class="${weekdayClass}">(${weekday})</span>
        </div>
      </td>

      <td class="pc-only">
        <div class="event-box">
          ${isPC ? holidayName : ""}
          ${slots["åˆå‰"].map(e=>e.html).join("")}
        </div>
      </td>

      <td class="pc-only">
        <div class="event-box">
          ${slots["åˆå¾Œ"].map(e=>e.html).join("")}
        </div>
      </td>

     <td class="sp-only">
       <div class="event-box">
         ${holidayName}   <!-- â† ã‚¹ãƒãƒ›ã§ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆåˆ—ã®å…ˆé ­ã«ç¥æ—¥å -->
         ${merged.map(e=>e.html).join("")}
       </div>
     </td>
    `;

    table.appendChild(tr);
  }

  box.appendChild(table);
  return box;
}

/* æœˆèª­ã¿è¾¼ã¿ */
async function loadMonth(year, month) {
  const container = document.getElementById("calendarContainer");
  container.innerHTML = `<div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>`;

  const events = await fetchEvents(CALENDAR_IDS[CURRENT_CALENDAR], year, month);
  const holidayEvents = await fetchEvents(HOLIDAY_CALENDAR_ID, year, month);

  const holidayMap = {};
  holidayEvents.forEach(ev => {
    const date = ev.start.date || (ev.start.dateTime ? ev.start.dateTime.split("T")[0] : "");
    holidayMap[date] = ev.summary;
  });

  container.innerHTML = "";
  container.appendChild(
    renderTable(
      events,
      holidayMap,
      year,
      month,
      CALENDAR_NAMES[CURRENT_CALENDAR],
      CALENDAR_COLORS[CURRENT_CALENDAR]
    )
  );
}

/* å…¨ã¦è¡¨ç¤º */
document.getElementById("showAllBtn").onclick = async () => {
  const container = document.getElementById("calendarContainer");
  container.innerHTML = `<div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>`;

  const activeTab = document.querySelector("#monthTabs .active");
  const [year, month] = activeTab.textContent.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);

  const allEvents = [];

  for (let cal = 1; cal <= 3; cal++) {
    const events = await fetchEvents(CALENDAR_IDS[cal], year, month - 1);
    events.forEach(ev => {
      ev._facility = CALENDAR_NAMES[cal];
      allEvents.push(ev);
    });
  }

  const holidayEvents = await fetchEvents(HOLIDAY_CALENDAR_ID, year, month - 1);
  const holidayMap = {};
  holidayEvents.forEach(ev => {
    const date = ev.start.date || (ev.start.dateTime ? ev.start.dateTime.split("T")[0] : "");
    holidayMap[date] = ev.summary;
  });

  container.innerHTML = "";
  container.appendChild(
    renderTable(
      allEvents,
      holidayMap,
      year,
      month - 1,
      "å…¨æ–½è¨­çµ±åˆ",
      CALENDAR_COLORS.all
    )
  );
};

/* åˆæœŸè¡¨ç¤º */
loadMonth(today.getFullYear(), today.getMonth());
</script>

</body>
</html>

